#!/usr/bin/env php
<?php
declare(strict_types=1);

use Psr\Container\ContainerInterface;
use SwowCloud\Job\Application;
use Spatie\Emoji\Emoji;

//TODO 重点 2022.1.20号适配其他框架时发现不好适配的问题，现考虑如下

/**
 * 1.考虑把config移除
 * 2.考虑如何把BASE_PATH常量如何优化或者定义
 * 3.Job和Dag移除src目录
 */

//优化后的代码
$dir = __DIR__ . '/..';
if (!file_exists($dir . '/autoload.php')) {
    defined('BASE_PATH') or define('BASE_PATH', $dir);
    $dir = __DIR__ . '/../vendor';
}

if (!file_exists($dir . '/autoload.php')) {
    defined('BASE_PATH') or define('BASE_PATH', $dir);
    $dir = __DIR__ . '/../../..';
}

if (!file_exists($dir . '/autoload.php')) {
    echo 'Autoload not found.';
    exit(1);
}
ini_set('display_errors', 'on');
ini_set('display_startup_errors', 'on');
error_reporting(E_ALL);
date_default_timezone_set('Asia/Shanghai');

/** @noinspection PhpIncludeInspection */
require_once $dir . '/autoload.php';

if (!extension_loaded('swow')) {
    exit(sprintf('Swow extension is required%s#', Emoji::faceWithTearsOfJoy()));
}

(static function ()
{
    Hyperf\Di\ClassLoader::init();
    /** @var ContainerInterface $container */
    $container   = require BASE_PATH . '/config/container.php';
    $application = $container->get(Application::class);
    $application->run();
})();
